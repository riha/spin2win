var ViewModels;(function(n){(function(n){var t=function(){function t(i,r,u){var f,e;this.settings=r,this.wheel=u,f=this,this.degree=ko.observable(0),this.activePlayers=ko.observableArray([]),this.currentRound=ko.observable(1),this.running=ko.observable(!1),this.winner=ko.observable(),e=Common.Utils.colors,$.each(i,function(t,i){var u=new n.ActivePlayer(i.id,i.name,i.numberOfSlots,i.pictureUrl,r.numberOfRounds,e[t]);f.activePlayers.push(u)}),console.log(this.winner()),this.activePlayers.sort(t.sortByWinnerFunc),this.wheel.draw(this.activePlayers()),this.playerListAnimator=new n.PlayerListAnimator(this.activePlayers),this.playerListAnimator.showPlayers(),this.currentPlayer=ko.observable({name:"Mr. Nobody"}),this.degreeTransformation=ko.computed(function(){return"rotate("+f.degree()+"deg)"}),this.continuePlay=this.continuePlay.bind(this),$(document).bind("move",function(n,t){f.degree(t)}),$(document).bind("current",function(n,t){var i=f.getActivePlayerById(t.id);f.setCurrentPlayer(i)}),$(document).bind("complete",function(n,t){f.roundWinner=f.getActivePlayerById(t.id),r.numberOfRounds==f.roundWinner.numberOfWins()+1?f.showGameWinner():f.showRoundWinner()}),this.spin=this.spin.bind(this)}return t.prototype.continuePlay=function(){for(var n=0;n<this.activePlayers().length;n++)if(this.winner().id==this.activePlayers()[n].id){this.activePlayers.splice(n,1);break}this.wheel.clear(),this.wheel.draw(this.activePlayers()),this.running(!1)},t.prototype.showGameWinner=function(){this.roundWinner.addWin(),this.winner(this.roundWinner)},t.prototype.showRoundWinner=function(){var n=this;this.setCurrentPlayer(this.roundWinner),this.roundWinner.runWinnerAnimation(!0),setTimeout(function(){n.roundWinner.runWinnerAnimation(!1),n.playerListAnimator.hidePlayers().done(function(){console.log("done",n),n.roundWinner.addWin(),n.activePlayers.sort(t.sortByWinnerFunc),console.log("after sort",n.activePlayers()),n.playerListAnimator.showPlayers().done(function(){n.enableNextRound()})})},500),console.log("complete",this.roundWinner)},t.prototype.enableNextRound=function(){this.currentRound(this.currentRound()+1),this.running(!1)},t.sortByWinnerFunc=function(n,t){return n.numberOfWins()<t.numberOfWins()?1:n.numberOfWins()>t.numberOfWins()?-1:n.name>t.name?1:n.name<t.name?-1:0},t.prototype.setCurrentPlayer=function(n){n.id!=this.currentPlayer().id&&this.currentPlayer(n)},t.prototype.getActivePlayerById=function(n){return ko.utils.arrayFirst(this.activePlayers(),function(t){return t.id==n})},t.prototype.spin=function(){this.running()||(this.wheel.spin(),this.running(!0))},t}();n.ViewModel=t})(n.Play||(n.Play={}));var t=n.Play})(ViewModels||(ViewModels={}))